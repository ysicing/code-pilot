# 多角色分析

使用多个专业角色并行分析同一对象，生成综合评估报告的高级命令。

## 使用方法

```bash
/multi-role <角色1>,<角色2> [--agent|-a] [分析对象]
/multi-role <角色1>,<角色2>,<角色3> [--agent|-a] [分析对象]
```

**重要语法**：
- `--agent` 选项应当放在角色指定之后
- 分析消息要写在 `--agent` 之后
- **正确**：`/multi-role qa,architect --agent 评估计划`
- **错误**：`/multi-role qa,architect 评估计划 --agent`

## 选项说明

- `--agent` 或 `-a`：将各角色作为子代理并行执行（推荐用于大规模分析）
  - 显著提升分析效率（2-4倍速度提升）
  - 适用于复杂系统的综合评估
  - 当角色描述中包含积极委托短语时，启用更主动的自动化

## 基本示例

```bash
# 安全和性能的双重分析
/multi-role security,performance
"评估这个 API 端点的安全性和性能表现"

# 大规模系统的并行分析（子代理模式）
/multi-role security,performance --agent
"全面分析系统的安全性和性能，包括潜在风险和优化建议"

# 前端、移动、性能的综合分析
/multi-role frontend,mobile,performance
"分析用户界面在不同平台上的表现和优化方案"

# 架构设计的多角度评估（子代理模式）
/multi-role architect,security,performance --agent
"评估微服务化设计方案，提供全面的专业建议"
```

## 分析流程

### 阶段 1：并行专业分析
各角色从专业视角独立分析：
- 运用领域专业知识进行深度评估
- 按照各自专业标准进行判定
- 生成独立的专业评估和评分

### 阶段 2：交叉分析整合
系统化整合多角度结果：
- 整理各专业角色的评估结果
- 识别观点重复、矛盾和互补关系
- 分析专业评估间的依赖和冲突

### 阶段 3：综合报告生成
输出最终整合方案：
- 生成带优先级的综合行动计划
- 明确权衡取舍和实施策略
- 提供详细的实施路线图

## 输出格式示例

### 双角色分析格式

```markdown
多角色分析：Security + Performance
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

分析对象：API 端点 /api/users

### Security 分析结果
认证机制：JWT 验证实施完善 ✅
授权控制：基于角色的访问控制存在漏洞 ⚠️
数据加密：API 密钥在日志中明文输出 ❌

**评估分数**：65/100
**风险等级**：High（涉及敏感用户数据）

### Performance 分析结果
响应时间：平均 180ms（目标 <200ms）✅
数据库查询：检测到 N+1 查询问题 ⚠️
缓存策略：Redis 缓存未实施 ❌

**评估分数**：70/100
**优化潜力**：Medium（当前可接受，有改进空间）

### 交叉关联分析
#### 协同效应机会
- 实施 Redis 缓存时同步考虑数据加密
- 优化日志输出提升安全性和调试效率

#### 权衡考量
- 加强授权检查 ↔ 对响应时间的潜在影响
- 实施日志加密 ↔ 开发调试效率降低

### 综合优先级方案
🔥 **Critical**：修复 API 密钥明文日志输出
🔥 **High**：解决数据库 N+1 查询问题
⚡ **Medium**：实施 Redis 缓存层 + 数据加密
📈 **Low**：细化基于角色的授权控制

### 实施路线图
- **第 1 周**：紧急修复 API 密钥日志泄露
- **第 2 周**：优化数据库查询策略
- **第 3-4 周**：设计并实施缓存层
- **第 2 月**：逐步完善授权控制机制
```

### 三角色分析格式

```markdown
多角色分析：Frontend + Mobile + Performance
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

分析对象：用户资料界面

### Frontend 分析结果
界面可用性：布局直观，信息层次清晰 ✅
可访问性：WCAG 2.1 符合率 85% ⚠️
响应式设计：平板设备显示存在问题 ❌

### Mobile 分析结果
触摸目标：按钮尺寸符合 44pt 最小标准 ✅
单手操作：重要按钮位置不利于单手使用 ⚠️
离线支持：未实施离线数据缓存 ❌

### Performance 分析结果
首屏加载：LCP 2.1 秒（符合良好标准）✅
图像优化：不支持 WebP 格式 ⚠️
延迟加载：未实施图片延迟加载 ❌

### 综合优化方案
1. **移动体验优化**（单手操作 + 离线支持）
2. **性能提升**（WebP 图像 + 延迟加载）
3. **响应式改进**（平板界面适配）

**优先级排序**：Mobile > Performance > Frontend  
**预计实施周期**：3-4 周
```

## 有效角色组合模式

### 安全主导组合
```bash
# 认证系统安全设计
/multi-role security,architect --agent
"分析认证系统的安全架构设计"

# 前端安全评估
/multi-role security,frontend --agent
"评估登录界面的安全实施"

# 移动应用安全
/multi-role security,mobile --agent
"分析移动应用的数据保护策略"
```

### 性能主导组合
```bash
# 可扩展性架构设计
/multi-role performance,architect --agent
"设计高并发系统的可扩展架构"

# Web 性能优化
/multi-role performance,frontend --agent
"全面优化 Web 应用的加载和运行性能"

# 移动应用性能
/multi-role performance,mobile --agent
"优化移动应用的运行效率和资源使用"
```

### 用户体验主导组合
```bash
# 跨平台界面设计
/multi-role frontend,mobile --agent
"设计统一的跨平台用户界面"

# 性能与体验平衡
/multi-role frontend,performance --agent
"在用户体验和性能之间找到最佳平衡"

# 移动用户体验优化
/multi-role mobile,performance --agent
"全面优化移动端的用户体验"
```

### 全面评估组合
```bash
# 系统整体评估（4角色）
/multi-role architect,security,performance,qa --agent
"对整个系统进行全方位专业评估"

# 用户界面综合评估（3角色）
/multi-role frontend,mobile,performance --agent
"全面评估用户界面的各项指标"

# 移动应用综合诊断（3角色）
/multi-role security,performance,mobile --agent
"综合诊断移动应用的各项表现"
```

## 实践应用示例

```bash
# 结合代码文件分析
cat src/components/UserProfile.tsx
/multi-role frontend,mobile --agent
"从前端和移动两个角度评估这个用户资料组件"

# 系统设计文档评估
cat docs/architecture-design.md
/multi-role architect,security,performance --agent
"从架构、安全、性能三个专业角度评估这个设计方案"

# 性能问题诊断
cat logs/performance-issues.log
/multi-role performance,qa --agent
"从性能和质量保证角度分析这些性能问题"
```

## Multi-role vs 其他命令的使用区分

### 使用 Multi-role 的场合
- ✅ 需要多个专业领域的独立评估
- ✅ 希望制定综合改进计划
- ✅ 需要识别和整理专业观点的矛盾或重复
- ✅ 要确定实施优先级和资源分配

### 使用 Role-debate 的场合
- ✅ 专业领域间存在明显权衡和分歧
- ✅ 技术选型需要深入讨论
- ✅ 希望通过专业辩论决定设计方针
- ✅ 需要听取不同观点的充分论证

### 使用 UltraThink 的场合
- ✅ 单一复杂问题需要深度思考
- ✅ 需要结构化分析复杂决策
- ✅ 重要战略规划和技术选型

## 子代理并行执行（--agent）

### 性能优势
使用 `--agent` 选项显著提升分析效率：

| 角色数量 | 常规执行时间 | --agent 执行时间 | 效率提升 |
|---------|------------|-----------------|---------|
| 2 角色  | 2-3 分钟   | 1 分钟          | 50%     |
| 3 角色  | 3-5 分钟   | 1-2 分钟        | 60%     |
| 4 角色  | 5-8 分钟   | 2-3 分钟        | 65%     |

### 执行模式对比
```
常规执行（顺序）:
角色1 → 角色2 → 角色3 → 综合分析

--agent 执行（并行）:
角色1 ──┐
角色2 ──┼─→ 综合分析
角色3 ──┘
```

### 最佳实践建议
- **大规模分析**：建议使用 `--agent` 选项
- **快速评估**：2个角色可使用常规模式
- **复杂系统**：3个以上角色推荐并行模式
- **资源考量**：`--agent` 模式消耗更多计算资源

## 注意事项

- **分析深度**：3个以上角色的分析输出会较长，请预留充足时间
- **资源使用**：`--agent` 并行模式需要更多计算资源
- **结果整合**：出现专业观点矛盾时，可考虑使用 role-debate 进一步讨论
- **决策权重**：最终实施决策需要用户基于项目实际情况进行判断