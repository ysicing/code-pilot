# Claude Code 多智能体工作流系统

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Claude Code](https://img.shields.io/badge/Claude-Code-blue)](https://claude.ai/code)

> 将开发工作流从手动命令链升级为自动化专家团队，采用**轻量级质量门控**和**专业化分工**。

## 🎯 核心理念

**质量门控自动化 + 专业化分工 + 轻量级流程**

本仓库提供了一个**轻量级的 Claude Code 元框架**，实现：

- **🎛️ 质量门控自动化**：客观90%标准替代主观判断
- **🧠 专业化分工**：每个工具专注一个领域（避免"万能AI"）  
- **⚡ 轻量级流程**：核心工作流步骤，无冗余环节
- **📊 上下文隔离**：每个智能体保持专业性，避免污染
- **🎯 智能测试**：比例化测试与UI感知策略，防止过度测试

## 🚀 从手动混乱到自动化质量

**之前**：需要持续监督的手动命令链
```bash
/ask → /code → /test → /bugfix → /optimize
# 1-2小时手动协调，主观质量判断
```

**之后**：一键自动化专家工作流与客观质量门控
```bash
/requirements-pilot "实现JWT用户认证系统"
# 30分钟自动执行，90%质量门控，智能测试决策
```

## 📋 两种主要使用模式

### 1. 🏭 需求驱动工作流（自动化专家团队）

**架构**：以需求为中心的工作流，配备质量门控和智能测试
```
requirements-generate → requirements-code → requirements-review → (✅ 就绪?) → 智能测试决策
         ↑                                              ↓ (⚠️ 需要改进)
         ←←←←←← 自动优化循环 ←←←←←←
```

**使用方法**：
```bash
# 一条命令完成完整开发工作流
/requirements-pilot "构建用户管理系统，支持RBAC权限"

# 高级工作流与智能测试
先使用 requirements-generate，然后 requirements-code，再用 requirements-review，
如果就绪则询问用户："代码完成。运行测试？(y/n/lint)"
```

### 2. 🎛️ 阶段化开发（手动协调）

**架构**：针对特定阶段的专业工具

#### **📋 阶段1：需求分析**
```bash
/story-breakdown     # 将复杂功能转化为可实现的用户故事
                     # - 1-3天完成预估
                     # - 明确验收标准  
                     # - 实现优先级排序
                     # - 依赖关系映射
```

#### **🏛️ 阶段2：架构设计**  
```bash
/ask                # 高级系统架构师咨询
                    # - 多专家咨询（4个专家）
                    # - UltraThink方法论进行全面分析
                    # - 战略技术指导与权衡分析
                    # - 纯架构指导，不修改代码
```

#### **⚡ 阶段3：实现开发**
```bash
/requirements-pilot # 完整自动化流水线（推荐）
                    # - 100分质量评估与用户批准门控
                    # - 智能测试决策（--test/--no-test）
                    # - 文件结构管理（.claude/specs/）

/code               # 直接功能实现
                    # - 适用于简单功能或特定组件
```

#### **🔍 阶段4：质量保证**
```bash
/review             # 多维度代码审查
                    # - 4专家审查员（质量、安全、性能、架构）
                    # - 3级评分：✅ 就绪 / ⚠️ 需改进 / ❌ 重大问题
                    # - 实用性优于完美性的实用专注
```

#### **🧪 阶段5：测试验证**
```bash
/test               # 智能测试策略
                    # - UI变更：仅Lint方法
                    # - 小变更（1-5行）：比例化测试
                    # - 业务逻辑：全面测试
```

#### **🐛 阶段6：问题解决**
```bash
/debug              # UltraThink调试协调器
                    # - 4阶段系统化调试
                    # - 假设精炼（5-7个 → 1-2个解决方案）
                    # - 修复前用户确认门控
                    # - 基于证据的诊断策略
```

#### **🚀 阶段7：发布准备**
```bash
/release-check      # 生产就绪验证
                    # - 基于风险的go/no-go决策
                    # - 实用清单方法
                    # - 问题的明确缓解计划
```

## 🔧 **灵活使用模式**

### 模式1：完整自动化（新功能）
```bash
# 单条命令处理整个工作流
/requirements-pilot "JWT认证与刷新令牌" --test
# → 需求(90+) → 用户批准 → 代码 → 审查(90+) → 测试
```

### 模式2：步骤式控制（复杂功能）  
```bash
/story-breakdown "电商结账流程"  # 分解为故事
/ask "结账流程：微服务vs单体架构"  # 架构指导
/requirements-pilot "支付处理故事1"  # 逐个故事实现
/review "验证支付安全性"  # 质量门控
/release-check "支付系统"  # 生产就绪
```

### 模式3：问题驱动（Bug修复）
```bash
/debug "生产API超时问题"  # 系统化诊断
/code "实现连接池修复"  # 直接修复实现  
/release-check "更新的API服务"  # 验证生产就绪
```

### 模式4：质量优先（关键系统）
```bash
/story-breakdown "金融交易系统"
/ask "金融数据的安全架构"
/requirements-pilot "核心交易逻辑" --test
/review "安全和性能验证"  
/release-check "金融系统组件"
```

## 🚀 快速开始

### 单命令开发
```bash
# 一条命令处理所有事情 - 需求、实现、审查、测试
/requirements-pilot "创建支持JWT令牌的用户认证REST API"

# 高级用法与测试控制
/requirements-pilot "构建电商购物车系统" --test
/requirements-pilot "添加UI主题切换器" --no-test  # 仅UI变更
```

### 阶段化开发  
```bash
# 需求分析优先
/story-breakdown "用户管理系统，支持RBAC权限"

# 架构咨询
/ask "微服务中基于角色访问控制的最佳实践"

# 带质量门控的实现
/requirements-pilot "用户注册故事" --test

# 生产就绪
/release-check "用户管理组件"
```

### 设置配置

克隆或复制配置结构：
```bash
# 你的项目目录
├── commands/          # 10个专业斜杠命令
├── agents/           # 9个子智能体配置  
├── CLAUDE.md         # Claude Code系统指令
└── WORKFLOW-GUIDE.md # 阶段化使用指南
```

## 💡 **关键创新**

### 1. **质量门控自动化**
用客观90%评分替代主观判断：
```python
# 传统方式："我觉得代码准备好了"
if developer_subjective_opinion:
    proceed()

# 本系统：客观质量测量
if requirements_score >= 90 and code_quality >= 90:
    proceed()
else:
    optimize_and_retry()
```

### 2. **专业化分工**
避免"万能AI"，使用领域专家：
```bash
❌ 一个AI做所有事：需求 + 编码 + 测试 + 部署
✅ 专家团队：需求专家 + 代码专家 + 质量专家 + 测试专家
```

### 3. **智能测试防止过度测试**
基于变更影响的比例化测试：
```bash
# UI颜色变更（1行） → 仅Lint检查
# 业务逻辑变更（50行） → 完整测试套件
# 新功能 → 全面测试包括边界情况
```

## 📚 工作流示例

### 企业用户认证系统

**步骤式方法**：
```bash
# 需求分析
/story-breakdown "企业SSO与LDAP集成"

# 架构咨询  
/ask "高可用系统的LDAP集成模式"

# 带质量门控的实现
/requirements-pilot "核心认证服务" --test

# 生产就绪验证
/release-check "认证系统组件"
```

**结果**：
- ✅ 可实现的用户故事，1-3天预估
- ✅ 架构指导与风险/权衡分析
- ✅ 生产就绪实现，90%+质量评分
- ✅ 基于变更复杂度的智能测试策略
- ✅ 明确的go/no-go发布决策

### API网关开发

**完整自动化**：
```bash
/requirements-pilot "微服务API网关，支持限流和熔断器" --test
```

**结果**：
- ✅ 需求确认，90+质量评分
- ✅ 实现前用户批准门控
- ✅ 为代码生成优化的技术规格
- ✅ 多维度代码审查（质量/安全/性能）
- ✅ 基于组件复杂度的智能测试

## 📋 完整命令参考

### 📋 需求与规划
- `/story-breakdown` - 将功能分解为可实现的用户故事
- `/requirements-pilot` - 完整自动化需求驱动流水线

### 🏛️ 架构与咨询  
- `/ask` - 高级系统架构师，4专家咨询方法论

### ⚡ 实现与开发
- `/code` - 带约束的直接功能实现

### 🔍 质量保证
- `/review` - 多维度代码审查（质量/安全/性能/架构）
- `/test` - 智能测试策略，比例化覆盖

### 🐛 问题解决
- `/debug` - UltraThink调试协调器，4阶段系统化分析
- `/bugfix` - 系统化bug修复工作流

### 🚀 运维与部署
- `/optimize` - 性能优化协调
- `/release-check` - 生产就绪验证，go/no-go决策

## 🏗️ 架构概览

### 核心组件

#### **Commands目录** (`/commands/`)
- **需求规划**：`/story-breakdown` - 功能分解为可实现故事
- **咨询服务**：`/ask` - 高级系统架构师，4专家咨询方法论
- **实现工具**：`/code` - 带约束的功能开发  
- **质量保证**：
  - `/test` - 全面测试策略
  - `/debug` - UltraThink调试协调器，4阶段系统化分析
  - `/review` - 多维度审查（质量、安全、性能、架构）
- **Bug解决**：`/bugfix` - 系统化bug修复工作流
- **性能优化**：`/optimize` - 性能优化协调
- **发布管理**：`/release-check` - 生产就绪验证，go/no-go决策
- **流水线**：`/requirements-pilot` - 完整流水线，质量门控和批准工作流

#### **Agents目录** (`/agents/`)
- **requirements-generate**：代码生成优化的技术规格，直接实现映射
- **requirements-code**：最小架构开销的直接实现智能体
- **requirements-review**：实用审查，专注功能性而非架构完美（3级评分）
- **requirements-testing**：智能测试，比例化覆盖和UI感知策略
- **bugfix**：分析和修复软件缺陷的bug解决专家
- **bugfix-verify**：客观评估的修复验证专家
- **code**：直接实现的开发协调员
- **debug**：UltraThink系统化问题分析，多智能体协调
- **optimize**：性能优化协调

### 多智能体协调系统

**4个核心专家**：
1. **需求生成器** - 实现就绪的技术规格
2. **代码实现器** - 直接代码生成，实用专注
3. **质量审查员** - 90%阈值验证，3级评分
4. **智能测试智能体** - 比例化测试，UI感知和过度测试预防

**关键特性**：
- **质量门控自动化**：客观90%标准用于进展决策
- **专业化分工**：每个智能体在独立上下文中工作，保持专业专注
- **智能测试**：UI感知策略防止过度测试同时保持质量
- **轻量级流程**：核心步骤，无官僚主义
- **实用专注**：工作解决方案优于架构完美

## 🤝 贡献

这是一个专注于**轻量级质量门控**的Claude Code配置框架。欢迎贡献：

1. **新阶段命令**：额外的开发阶段覆盖
2. **质量门控增强**：更好的客观测量标准  
3. **智能测试规则**：更复杂的测试决策算法
4. **工作流模式**：特定领域的新自动化序列

## 📄 许可证

MIT许可证 - 使用此框架通过自动化质量门控和专业化分工增强你的Claude Code工作流。